{"version":3,"file":"PopupContent.js","sources":["../../../src/select/base/PopupContent.tsx"],"sourcesContent":["import React, { Children, Ref, forwardRef, isValidElement, cloneElement } from 'react';\nimport classNames from 'classnames';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { getSelectValueArr } from '../util/helper';\nimport { TdSelectProps, SelectValue, TdOptionProps, SelectValueChangeTrigger } from '../type';\nimport useConfig from '../../hooks/useConfig';\nimport Option, { SelectOptionProps } from './Option';\n\ntype OptionsType = TdOptionProps[];\n\ninterface SelectPopupProps\n  extends Pick<\n    TdSelectProps,\n    | 'value'\n    | 'size'\n    | 'multiple'\n    | 'empty'\n    | 'options'\n    | 'max'\n    | 'loadingText'\n    | 'loading'\n    | 'valueType'\n    | 'keys'\n    | 'panelTopContent'\n    | 'panelBottomContent'\n  > {\n  onChange?: (\n    value: SelectValue,\n    context?: {\n      label?: string | number;\n      restData?: Record<string, any>;\n      e: React.MouseEvent<HTMLLIElement>;\n      trigger: SelectValueChangeTrigger;\n    },\n  ) => void;\n  /**\n   * 是否展示popup\n   */\n  showPopup: boolean;\n  /**\n   * 控制popup展示的函数\n   */\n  setShowPopup: (show: boolean) => void;\n  children?: React.ReactNode;\n}\n\nconst PopupContent = forwardRef((props: SelectPopupProps, ref: Ref<HTMLDivElement>) => {\n  const {\n    onChange,\n    value,\n    size,\n    max,\n    multiple,\n    showPopup,\n    setShowPopup,\n    options,\n    empty,\n    loadingText,\n    loading,\n    valueType,\n    children,\n    keys,\n    panelTopContent,\n    panelBottomContent,\n  } = props;\n\n  // 国际化文本初始化\n  const [local, t] = useLocaleReceiver('select');\n  const emptyText = t(local.empty);\n\n  const { classPrefix } = useConfig();\n  if (!children && !props.options) return null;\n\n  const onSelect: SelectOptionProps['onSelect'] = (selectedValue, { label, selected, event, restData }) => {\n    const isValObj = valueType === 'object';\n    let objVal = {};\n    if (isValObj) {\n      objVal = { ...restData };\n      if (!keys?.label) {\n        Object.assign(objVal, { label });\n      }\n      if (!keys?.value) {\n        Object.assign(objVal, { value: selectedValue });\n      }\n    }\n\n    if (!Object.keys(objVal).length) {\n      Object.assign(objVal, { [keys?.label || 'label']: label, [keys?.value || 'value']: selectedValue });\n    }\n    if (multiple) {\n      // calc multiple select values\n      const values = getSelectValueArr(value, selectedValue, selected, valueType, keys, objVal);\n      onChange(values, { label, e: event, trigger: 'check' });\n    } else {\n      // calc single select value\n      const selectVal = valueType === 'object' ? objVal : selectedValue;\n\n      onChange(selectVal, { label, e: event, trigger: 'check' });\n      setShowPopup(!showPopup);\n    }\n  };\n\n  const childrenWithProps = Children.map(children, (child) => {\n    if (isValidElement(child)) {\n      const addedProps = { size, max, multiple, selectedValue: value, onSelect };\n      return cloneElement(child, { ...addedProps });\n    }\n    return child;\n  });\n\n  // 渲染 options\n  const renderOptions = () => {\n    if (options) {\n      const uniqueOptions = [];\n      options.forEach((option: SelectOptionProps) => {\n        const index = uniqueOptions.findIndex((item) => item.label === option.label && item.value === option.value);\n        if (index === -1) {\n          uniqueOptions.push(option);\n        }\n      });\n      // 通过 options API配置的\n      return (\n        <ul className={`${classPrefix}-select__list`}>\n          {(uniqueOptions as OptionsType).map(\n            ({ value: optionValue, label, disabled, content, ...restData }, index) => (\n              <Option\n                key={index}\n                max={max}\n                label={label}\n                value={optionValue}\n                onSelect={onSelect}\n                selectedValue={value}\n                multiple={multiple}\n                size={size}\n                disabled={disabled}\n                restData={restData}\n                keys={keys}\n                content={content}\n              />\n            ),\n          )}\n        </ul>\n      );\n    }\n    return <ul className={`${classPrefix}-select__list`}>{childrenWithProps}</ul>;\n  };\n\n  const isEmpty = (Array.isArray(childrenWithProps) && !childrenWithProps.length) || (options && options.length === 0);\n\n  return (\n    <div\n      ref={ref}\n      className={classNames(`${classPrefix}-select__dropdown-inner`, {\n        [`${classPrefix}-select__dropdown-inner--size-s`]: size === 'small',\n        [`${classPrefix}-select__dropdown-inner--size-l`]: size === 'large',\n        [`${classPrefix}-select__dropdown-inner--size-m`]: size === 'medium',\n      })}\n    >\n      {panelTopContent}\n      {loading && <div className={`${classPrefix}-select__loading-tips`}>{loadingText}</div>}\n      {!loading && isEmpty && (\n        <div className={`${classPrefix}-select__empty`}>{empty ? empty : <p>{emptyText}</p>}</div>\n      )}\n      {!loading && !isEmpty && renderOptions()}\n      {panelBottomContent}\n    </div>\n  );\n});\n\nexport default PopupContent;\n"],"names":["PopupContent","forwardRef","props","ref","onChange","value","size","max","multiple","showPopup","setShowPopup","options","empty","loadingText","loading","valueType","children","keys","panelTopContent","panelBottomContent","useLocaleReceiver","local","t","emptyText","useConfig","classPrefix","onSelect","selectedValue","label","selected","event","restData","isValObj","objVal","Object","assign","length","values","getSelectValueArr","e","trigger","selectVal","childrenWithProps","Children","map","child","isValidElement","addedProps","cloneElement","renderOptions","uniqueOptions","forEach","option","index","findIndex","item","push","React","createElement","className","optionValue","disabled","content","Option","key","isEmpty","Array","isArray","classNames"],"mappings":"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"}