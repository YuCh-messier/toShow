{"version":3,"file":"Ellipsis.js","sources":["../../src/table/Ellipsis.tsx"],"sourcesContent":["import React, { useRef, useState, MouseEvent } from 'react';\nimport classNames from 'classnames';\n\nimport { TNode } from '../common';\nimport { isNodeOverflow } from '../_util/dom';\nimport Tooltip, { TooltipProps } from '../tooltip';\nimport useDebounce from '../hooks/useDebounce';\n\nexport interface EllipsisProps {\n  content?: string | TNode;\n  children?: string | TNode;\n  popupContent?: string | number | TNode;\n  placement?: TooltipProps['placement'];\n  attach?: () => HTMLElement;\n  tooltipProps?: TooltipProps;\n  zIndex?: number;\n  overlayClassName?: string;\n  classPrefix?: string;\n}\n\n/** 超出省略显示 */\nexport default function Ellipsis(props: EllipsisProps) {\n  const { classPrefix } = props;\n  const root = useRef<HTMLDivElement>();\n  const [isOverflow, setIsOverflow] = useState(false);\n\n  const ellipsisClasses = classNames([`${classPrefix}-table__ellipsis`, `${classPrefix}-text-ellipsis`]);\n\n  const innerEllipsisClassName: TooltipProps['overlayClassName'] = [\n    `${classPrefix}-table__ellipsis-content`,\n    props.overlayClassName,\n  ];\n\n  // 当表格数据量大时，不希望默认渲染全量的 Popup，期望在用户 mouseenter 的时候再显示\n  const onTriggerMouseenter = () => {\n    if (!root.current) return;\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  const onTriggerMouseleave = () => {\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  // 使用 debounce 有两个原因：1. 避免 safari/firefox 等浏览器不显示省略浮层；2. 避免省略列快速滚动时，出现一堆的省略浮层\n  const onMouseAround = useDebounce((e: MouseEvent<HTMLDivElement>) => {\n    e.type === 'mouseleave' ? onTriggerMouseleave() : onTriggerMouseenter();\n  }, 80);\n\n  const cellNode = props.children || props.content;\n  const ellipsisContent = (\n    <div ref={root} className={ellipsisClasses} onMouseEnter={onMouseAround} onMouseLeave={onMouseAround}>\n      {cellNode}\n    </div>\n  );\n  let content = null;\n  const { tooltipProps } = props;\n  if (isOverflow) {\n    const rProps = {\n      content: props.popupContent || cellNode,\n      destroyOnClose: true,\n      zIndex: props.zIndex,\n      attach: props.attach,\n      placement: props.placement,\n      overlayClassName: tooltipProps?.overlayClassName\n        ? innerEllipsisClassName.concat(tooltipProps.overlayClassName)\n        : innerEllipsisClassName,\n      ...(props.tooltipProps || {}),\n    };\n    content = <Tooltip {...rProps}>{ellipsisContent}</Tooltip>;\n  } else {\n    content = ellipsisContent;\n  }\n  return content;\n}\n\nEllipsis.displayName = 'Ellipsis';\n"],"names":["Ellipsis","props","classPrefix","root","useRef","useState","_slicedToArray","isOverflow","setIsOverflow","ellipsisClasses","classNames","innerEllipsisClassName","overlayClassName","onTriggerMouseenter","current","isNodeOverflow","onTriggerMouseleave","onMouseAround","useDebounce","e","type","cellNode","children","content","ellipsisContent","React","createElement","ref","className","onMouseEnter","onMouseLeave","tooltipProps","rProps","popupContent","destroyOnClose","zIndex","attach","placement","concat","Tooltip","displayName"],"mappings":"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"}