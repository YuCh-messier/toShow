{"version":3,"file":"Tooltip.js","sources":["../../src/tooltip/Tooltip.tsx"],"sourcesContent":["import React, { forwardRef, useState, useEffect, useRef, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport Popup, { PopupVisibleChangeContext, PopupRef } from '../popup';\nimport useConfig from '../hooks/useConfig';\nimport { TdTooltipProps } from './type';\nimport { tooltipDefaultProps } from './defaultProps';\n\nexport type TooltipProps = TdTooltipProps;\n\nexport interface TooltipRef extends PopupRef {\n  setVisible?: (v: boolean) => void;\n}\n\nconst Tooltip = forwardRef((props: TdTooltipProps, ref) => {\n  const {\n    theme,\n    showArrow = true,\n    destroyOnClose = true,\n    overlayClassName,\n    children,\n    duration = 0,\n    placement = 'top',\n    ...restProps\n  } = props;\n  const { classPrefix } = useConfig();\n  const [isTipShowed, setTipshow] = useState(duration !== 0);\n  const [timeup, setTimeup] = useState(false);\n  const popupRef = useRef<PopupRef>();\n  const timerRef = useRef<number | null>(null);\n  const [offset, setOffset] = useState([0, 0]);\n  const toolTipClass = classNames(\n    `${classPrefix}-tooltip`,\n    {\n      [`${classPrefix}-tooltip--${theme}`]: theme,\n    },\n    overlayClassName,\n  );\n  const isPlacedByMouse = placement === 'mouse';\n\n  const setVisible = (v: boolean) => {\n    if (duration !== 0) setTimeup(false);\n    setTipshow(v);\n  };\n\n  const calculatePos = (e) => {\n    const rect = (e.target as HTMLElement).getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    return {\n      x,\n      y,\n    };\n  };\n\n  const handleShowTip = (visible: boolean, { e, trigger }: PopupVisibleChangeContext) => {\n    if (duration === 0 || (duration !== 0 && timeup)) {\n      if (\n        visible &&\n        placement === 'mouse' &&\n        (trigger === 'trigger-element-hover' || trigger === 'trigger-element-click')\n      ) {\n        const { x } = calculatePos(e);\n        setOffset([x, 0]);\n      }\n      setTipshow(visible);\n    }\n  };\n\n  useEffect(() => {\n    if (duration !== 0 && !timeup) {\n      timerRef.current = window.setTimeout(() => {\n        setTipshow(false);\n        setTimeup(true);\n      }, duration);\n    }\n    return () => {\n      if (timerRef.current) window.clearTimeout(timerRef.current);\n    };\n  }, [duration, timeup]);\n\n  useImperativeHandle(ref, () => ({\n    setVisible,\n    ...((popupRef.current || {}) as any),\n  }));\n\n  return (\n    <Popup\n      ref={popupRef}\n      destroyOnClose={destroyOnClose}\n      showArrow={isPlacedByMouse ? false : showArrow}\n      overlayClassName={toolTipClass}\n      visible={isTipShowed}\n      onVisibleChange={handleShowTip}\n      popperOptions={{\n        modifiers: isPlacedByMouse ? [{ name: 'offset', options: { offset } }] : [],\n      }}\n      placement={isPlacedByMouse ? 'bottom-left' : placement}\n      {...restProps}\n    >\n      {children}\n    </Popup>\n  );\n});\n\nTooltip.displayName = 'Tooltip';\nTooltip.defaultProps = tooltipDefaultProps;\n\nexport default Tooltip;\n"],"names":["Tooltip","forwardRef","props","ref","theme","showArrow","destroyOnClose","overlayClassName","children","duration","placement","restProps","useConfig","classPrefix","useState","_slicedToArray","isTipShowed","setTipshow","timeup","setTimeup","popupRef","useRef","timerRef","offset","setOffset","toolTipClass","classNames","_defineProperty","isPlacedByMouse","setVisible","v","calculatePos","e","rect","target","getBoundingClientRect","x","clientX","left","y","clientY","top","handleShowTip","visible","trigger","useEffect","current","window","setTimeout","clearTimeout","useImperativeHandle","React","createElement","Popup","onVisibleChange","popperOptions","modifiers","name","options","displayName","defaultProps","tooltipDefaultProps"],"mappings":"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"}