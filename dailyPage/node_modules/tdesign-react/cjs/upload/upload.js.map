{"version":3,"file":"upload.js","sources":["../../src/upload/upload.tsx"],"sourcesContent":["import React, { ForwardedRef, forwardRef } from 'react';\nimport { UploadIcon } from 'tdesign-icons-react';\nimport classNames from 'classnames';\nimport NormalFile from './themes/NormalFile';\nimport DraggerFile from './themes/DraggerFile';\nimport ImageCard from './themes/ImageCard';\nimport MultipleFlowList from './themes/MultipleFlowList';\nimport useUpload from './hooks/useUpload';\nimport Button from '../button';\nimport { uploadDefaultProps } from './defaultProps';\nimport { CommonDisplayFileProps, UploadProps, UploadRef } from './interface';\nimport { UploadDragEvents } from './hooks/useDrag';\nimport CustomFile from './themes/CustomFile';\nimport { UploadFile } from './type';\n\n// const Upload = forwardRef((props: UploadProps, ref) => {\nfunction TdUpload<T extends UploadFile = UploadFile>(props: UploadProps<T>, ref: ForwardedRef<UploadRef>) {\n  const { theme } = props;\n  const {\n    locale,\n    classPrefix,\n    triggerUploadText,\n    toUploadFiles,\n    displayFiles,\n    uploadValue,\n    sizeOverLimitMessage,\n    uploading,\n    tipsClasses,\n    errorClasses,\n    inputRef,\n    disabled,\n    onRemove,\n    uploadFiles,\n    onNormalFileChange,\n    onDragFileChange,\n    triggerUpload,\n    cancelUpload,\n  } = useUpload(props);\n\n  React.useImperativeHandle(ref, () => ({\n    upload: inputRef.current,\n    uploading,\n    triggerUpload,\n    uploadFiles,\n    cancelUpload,\n  }));\n\n  const renderTrigger = () => {\n    const getDefaultTrigger = () => {\n      if (theme === 'file-input') {\n        return (\n          <Button disabled={disabled} variant=\"outline\" {...props.triggerButtonProps}>\n            {triggerUploadText}\n          </Button>\n        );\n      }\n      return (\n        <Button disabled={disabled} variant=\"outline\" icon={<UploadIcon />} {...props.triggerButtonProps}>\n          {triggerUploadText}\n        </Button>\n      );\n    };\n    return props.trigger || props.children || getDefaultTrigger();\n  };\n\n  const triggerElement = renderTrigger();\n\n  const commonDisplayFileProps: CommonDisplayFileProps = {\n    files: uploadValue,\n    toUploadFiles,\n    displayFiles,\n    theme,\n    abridgeName: props.abridgeName,\n    placeholder: props.placeholder,\n    disabled: props.disabled,\n    tips: props.tips,\n    sizeOverLimitMessage,\n    uploading,\n    classPrefix,\n    tipsClasses,\n    errorClasses,\n    locale,\n    autoUpload: props.autoUpload,\n    fileListDisplay: props.fileListDisplay,\n    onRemove,\n  };\n\n  const dragProps: UploadDragEvents = {\n    onDragFileChange,\n    onDragenter: props.onDragenter,\n    onDragleave: props.onDragleave,\n    onDrop: props.onDrop,\n  };\n\n  const getNormalFileNode = () => (\n    <NormalFile {...commonDisplayFileProps} multiple={props.multiple}>\n      <div className={`${classPrefix}-upload__trigger`} onClick={triggerUpload}>\n        {triggerElement}\n      </div>\n    </NormalFile>\n  );\n\n  const getSingleFileDraggerUploadNode = () => (\n    <DraggerFile\n      {...commonDisplayFileProps}\n      dragEvents={dragProps}\n      trigger={props.trigger}\n      cancelUpload={cancelUpload}\n      triggerUpload={triggerUpload}\n      uploadFiles={uploadFiles}\n    />\n  );\n\n  const getImageCardUploadNode = () => (\n    <ImageCard\n      {...commonDisplayFileProps}\n      multiple={props.multiple}\n      max={props.max}\n      showUploadProgress={props.showUploadProgress}\n      triggerUpload={triggerUpload}\n      uploadFiles={uploadFiles}\n      cancelUpload={cancelUpload}\n      onPreview={props.onPreview}\n    />\n  );\n\n  const getFlowListNode = () => (\n    <MultipleFlowList\n      {...commonDisplayFileProps}\n      isBatchUpload={props.isBatchUpload}\n      draggable={props.draggable}\n      dragEvents={dragProps}\n      uploadFiles={uploadFiles}\n      cancelUpload={cancelUpload}\n      onPreview={props.onPreview}\n    >\n      <div className={`${classPrefix}-upload__trigger`} onClick={triggerUpload}>\n        {triggerElement}\n      </div>\n    </MultipleFlowList>\n  );\n\n  const getCustomFile = () => (\n    <CustomFile\n      {...commonDisplayFileProps}\n      draggable={props.draggable}\n      dragContent={props.dragContent}\n      dragEvents={dragProps}\n      triggerUpload={triggerUpload}\n      childrenNode={props.children}\n      trigger={props.trigger}\n    >\n      {triggerElement}\n    </CustomFile>\n  );\n\n  return (\n    <div className={classNames([props.className, `${classPrefix}-upload`])} style={props.style}>\n      <input\n        ref={inputRef}\n        type=\"file\"\n        disabled={disabled}\n        onChange={onNormalFileChange}\n        multiple={props.multiple}\n        accept={props.accept}\n        hidden\n      />\n      {['file', 'file-input'].includes(theme) && !props.draggable && getNormalFileNode()}\n      {['file', 'image'].includes(theme) && props.draggable && getSingleFileDraggerUploadNode()}\n      {theme === 'image' && !props.draggable && getImageCardUploadNode()}\n      {['image-flow', 'file-flow'].includes(theme) && getFlowListNode()}\n      {theme === 'custom' && getCustomFile()}\n      {props.tips && (\n        <small className={classNames([tipsClasses, { [`${classPrefix}-upload__tips-${props.status}`]: props.status }])}>\n          {props.tips}\n        </small>\n      )}\n    </div>\n  );\n}\n\nexport type UploadOuterForwardRef = {\n  <T>(props: UploadProps<T> & { ref?: ForwardedRef<UploadRef> }): ReturnType<typeof TdUpload>;\n} & React.ForwardRefExoticComponent<UploadProps>;\n\nconst Upload = forwardRef(TdUpload) as UploadOuterForwardRef;\n\nUpload.displayName = 'Upload';\nUpload.defaultProps = uploadDefaultProps;\n\nexport default Upload;\n"],"names":["TdUpload","props","ref","theme","useUpload","locale","classPrefix","triggerUploadText","toUploadFiles","displayFiles","uploadValue","sizeOverLimitMessage","uploading","tipsClasses","errorClasses","inputRef","disabled","onRemove","uploadFiles","onNormalFileChange","onDragFileChange","triggerUpload","cancelUpload","React","useImperativeHandle","upload","current","renderTrigger","getDefaultTrigger","createElement","Button","variant","triggerButtonProps","icon","UploadIcon","trigger","children","triggerElement","commonDisplayFileProps","files","abridgeName","placeholder","tips","autoUpload","fileListDisplay","dragProps","onDragenter","onDragleave","onDrop","getNormalFileNode","NormalFile","multiple","className","onClick","getSingleFileDraggerUploadNode","DraggerFile","dragEvents","getImageCardUploadNode","ImageCard","max","showUploadProgress","onPreview","getFlowListNode","MultipleFlowList","isBatchUpload","draggable","getCustomFile","CustomFile","dragContent","childrenNode","classNames","style","type","onChange","accept","hidden","includes","status","Upload","forwardRef","displayName","defaultProps","uploadDefaultProps"],"mappings":"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"}