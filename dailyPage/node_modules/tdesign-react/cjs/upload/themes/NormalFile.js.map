{"version":3,"file":"NormalFile.js","sources":["../../../src/upload/themes/NormalFile.tsx"],"sourcesContent":["import React from 'react';\nimport {\n  CloseIcon as TdCloseIcon,\n  TimeFilledIcon as TdTimeFilledIcon,\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n  CloseCircleFilledIcon as TdCloseCircleFilledIcon,\n} from 'tdesign-icons-react';\nimport classNames from 'classnames';\nimport TLoading from '../../loading';\nimport Link from '../../link';\nimport { UploadFile } from '../type';\nimport { abridgeName } from '../../_common/js/upload/utils';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\nimport { CommonDisplayFileProps } from '../interface';\n\nexport interface NormalFileProps extends CommonDisplayFileProps {\n  multiple: boolean;\n}\n\nexport default function NormalFile(props: NormalFileProps) {\n  const { theme, disabled, classPrefix, locale } = props;\n\n  const { CloseIcon, TimeFilledIcon, CheckCircleFilledIcon, ErrorCircleFilledIcon, CloseCircleFilledIcon } =\n    useGlobalIcon({\n      CloseIcon: TdCloseIcon,\n      TimeFilledIcon: TdTimeFilledIcon,\n      CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n      ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n      CloseCircleFilledIcon: TdCloseCircleFilledIcon,\n    });\n\n  const uploadPrefix = `${classPrefix}-upload`;\n\n  const renderProgress = (percent: number) => (\n    <div className={`${uploadPrefix}__single-progress`}>\n      <TLoading />\n      <span className={`${uploadPrefix}__single-percent`}>{percent || 0}%</span>\n    </div>\n  );\n\n  // 文本型预览\n  const renderFilePreviewAsText = (files: UploadFile[]) => {\n    if (theme !== 'file') return null;\n    if (!props.multiple && files[0]?.status === 'fail') {\n      return null;\n    }\n    return files.map((file, index) => (\n      <div\n        className={`${uploadPrefix}__single-display-text ${uploadPrefix}__display-text--margin`}\n        key={file.name + index + file.percent + file.status}\n      >\n        {file.url ? (\n          <Link href={file.url} target=\"_blank\" hover=\"color\" size=\"small\" className={`${uploadPrefix}__single-name`}>\n            {file.name}\n          </Link>\n        ) : (\n          <span className={`${uploadPrefix}__single-name`}>{file.name}</span>\n        )}\n        {file.status === 'fail' && (\n          <div className={`${uploadPrefix}__flow-status`}>\n            <ErrorCircleFilledIcon />\n          </div>\n        )}\n        {file.status === 'waiting' && (\n          <div className={`${uploadPrefix}__flow-status`}>\n            <TimeFilledIcon />\n          </div>\n        )}\n        {file.status === 'progress' && renderProgress(file.percent)}\n        {!disabled && file.status !== 'progress' && (\n          <CloseIcon className={`${uploadPrefix}__icon-delete`} onClick={(e) => props.onRemove({ e, file, index })} />\n        )}\n      </div>\n    ));\n  };\n\n  // 输入框型预览\n  const renderFilePreviewAsInput = () => {\n    if (theme !== 'file-input') return;\n    const file = props.displayFiles[0];\n    const inputTextClass = [\n      `${classPrefix}-input__inner`,\n      { [`${uploadPrefix}__placeholder`]: !props.displayFiles[0] },\n    ];\n    const disabledClass = disabled ? `${classPrefix}-is-disabled` : '';\n    const fileName =\n      props.abridgeName?.length && file?.name\n        ? abridgeName(file.name, props.abridgeName[0], props.abridgeName[1])\n        : file?.name;\n    return (\n      <div className={`${uploadPrefix}__single-input-preview ${classPrefix}-input ${disabledClass}`}>\n        <div className={classNames(inputTextClass)}>\n          <span className={`${uploadPrefix}__single-input-text`}>{file?.name ? fileName : props.placeholder}</span>\n          {file?.status === 'progress' && renderProgress(file.percent)}\n          {file?.status === 'waiting' && <TimeFilledIcon className={`${uploadPrefix}__status-icon`} />}\n          {file?.url && file.status === 'success' && (\n            <CheckCircleFilledIcon className={`${uploadPrefix}__status-icon`} />\n          )}\n          {file?.name && file.status === 'fail' && <ErrorCircleFilledIcon className={`${uploadPrefix}__status-icon`} />}\n          {!disabled && (\n            <CloseCircleFilledIcon\n              className={`${uploadPrefix}__single-input-clear`}\n              onClick={(e) => props.onRemove({ e, file, index: 0 })}\n            />\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  const { displayFiles } = props;\n  const fileListDisplay = props.fileListDisplay?.({ files: displayFiles });\n\n  const classes = [`${uploadPrefix}__single`, `${uploadPrefix}__single-${theme}`];\n  return (\n    <div className={classNames(classes)}>\n      {theme === 'file-input' && renderFilePreviewAsInput()}\n\n      {props.children}\n\n      {theme === 'file' && props.placeholder && !displayFiles[0] && (\n        <small className={classNames(props.tipsClasses)}>{props.placeholder}</small>\n      )}\n\n      {fileListDisplay || renderFilePreviewAsText(displayFiles)}\n\n      {props.sizeOverLimitMessage && (\n        <small className={classNames(props.errorClasses)}>{props.sizeOverLimitMessage}</small>\n      )}\n\n      {/* 单文件上传失败要显示失败的原因 */}\n      {!props.multiple && displayFiles[0]?.status === 'fail' && theme === 'file' ? (\n        <small className={classNames(props.errorClasses)}>\n          {displayFiles[0].response?.error || locale.progress.failText}\n        </small>\n      ) : null}\n    </div>\n  );\n}\n\nNormalFile.displayName = 'NormalFile';\n"],"names":["NormalFile","props","theme","disabled","classPrefix","locale","useGlobalIcon","CloseIcon","TdCloseIcon","TimeFilledIcon","TdTimeFilledIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","CloseCircleFilledIcon","TdCloseCircleFilledIcon","uploadPrefix","renderProgress","percent","React","createElement","className","TLoading","renderFilePreviewAsText","files","multiple","status","map","file","index","key","name","url","Link","href","target","hover","size","onClick","e","onRemove","renderFilePreviewAsInput","displayFiles","inputTextClass","disabledClass","fileName","abridgeName","length","classNames","placeholder","fileListDisplay","classes","children","tipsClasses","sizeOverLimitMessage","errorClasses","response","error","progress","failText","displayName"],"mappings":"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"}