{"version":3,"file":"RenderDialog.js","sources":["../../src/dialog/RenderDialog.tsx"],"sourcesContent":["import React, { useRef, CSSProperties, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport classnames from 'classnames';\nimport Portal from '../common/Portal';\nimport noop from '../_util/noop';\nimport useLayoutEffect from '../_util/useLayoutEffect';\nimport { DialogProps } from './Dialog';\nimport useDialogEsc from '../_util/useDialogEsc';\nimport { dialogDefaultProps } from './defaultProps';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\n\nfunction GetCSSValue(v: string | number) {\n  return Number.isNaN(Number(v)) ? v : `${Number(v)}px`;\n}\nexport interface RenderDialogProps extends DialogProps {\n  prefixCls?: string;\n  classPrefix: string;\n}\n\nconst transitionTime = 300;\nlet mousePosition: { x: number; y: number } | null;\nconst getClickPosition = (e: MouseEvent) => {\n  mousePosition = {\n    x: e.clientX,\n    y: e.clientY,\n  };\n  setTimeout(() => {\n    mousePosition = null;\n  }, 100);\n};\nif (typeof window !== 'undefined' && window.document && window.document.documentElement) {\n  document.documentElement.addEventListener('click', getClickPosition, true);\n}\nconst RenderDialog = forwardRef((props: RenderDialogProps, ref: React.Ref<HTMLDivElement>) => {\n  const [local] = useLocaleReceiver('dialog');\n  const {\n    prefixCls,\n    attach,\n    visible,\n    mode,\n    zIndex,\n    showOverlay,\n    onEscKeydown = noop,\n    onClosed = noop,\n    onClose = noop,\n    onCloseBtnClick = noop,\n    onOverlayClick = noop,\n    onConfirm = noop,\n    preventScrollThrough,\n    closeBtn,\n    closeOnEscKeydown,\n    confirmOnEnter,\n    closeOnOverlayClick,\n    destroyOnClose,\n    showInAttachedElement,\n  } = props;\n\n  const wrap = useRef<HTMLDivElement>();\n  const dialog = useRef<HTMLDivElement>();\n  const dialogPosition = useRef<HTMLDivElement>();\n  const maskRef = useRef<HTMLDivElement>();\n  const portalRef = useRef<HTMLDivElement>();\n  const bodyOverflow = useRef<string>();\n  const bodyCssTextRef = useRef<string>();\n  const contentClickRef = useRef(false);\n  const isModal = mode === 'modal';\n  const isNormal = mode === 'normal';\n  const canDraggable = props.draggable && mode === 'modeless';\n  const dialogOpenClass = `${prefixCls}__${mode}`;\n  useDialogEsc(visible, wrap);\n  useImperativeHandle(ref, () => wrap.current);\n  useLayoutEffect(() => {\n    bodyOverflow.current = document.body.style.overflow;\n    bodyCssTextRef.current = document.body.style.cssText;\n  }, []);\n\n  useLayoutEffect(() => {\n    if (visible) {\n      if (isModal && bodyOverflow.current !== 'hidden' && preventScrollThrough && !showInAttachedElement) {\n        const scrollWidth = window.innerWidth - document.body.offsetWidth;\n        // 减少回流\n        if (bodyCssTextRef.current === '') {\n          let bodyCssText = 'overflow: hidden;';\n          if (scrollWidth > 0) {\n            bodyCssText += `position: relative;width: calc(100% - ${scrollWidth}px);`;\n          }\n          document.body.style.cssText = bodyCssText;\n        } else {\n          if (scrollWidth > 0) {\n            document.body.style.width = `calc(100% - ${scrollWidth}px)`;\n            document.body.style.position = 'relative';\n          }\n          document.body.style.overflow = 'hidden';\n        }\n      }\n      if (wrap.current) {\n        wrap.current.focus();\n      }\n    } else if (isModal) {\n      const openDialogDom = document.querySelectorAll(`${prefixCls}__mode`);\n      if (openDialogDom.length < 1) {\n        document.body.style.cssText = bodyCssTextRef.current;\n      }\n    }\n\n    // 组件销毁后重置 body 样式\n    return () => {\n      if (isModal) {\n        // 此处只能查询 mode 模式的 dialog 个数 因为 modeless 会点击透传 normal 是正常文档流\n        const openDialogDom = document.querySelectorAll(`${prefixCls}__mode`);\n        if (openDialogDom.length < 1) {\n          document.body.style.cssText = bodyCssTextRef.current;\n          document.body.style.overflow = bodyOverflow.current;\n        }\n      } else {\n        document.body.style.cssText = bodyCssTextRef.current;\n        document.body.style.overflow = bodyOverflow.current;\n      }\n    };\n  }, [preventScrollThrough, attach, visible, mode, isModal, showInAttachedElement, prefixCls]);\n\n  useEffect(() => {\n    // 动画渲染初始位置\n    if (visible) {\n      if (mousePosition && dialog.current) {\n        dialog.current.style.transformOrigin = `${mousePosition.x - dialog.current.offsetLeft}px ${\n          mousePosition.y - dialog.current.offsetTop\n        }px`;\n      }\n    }\n  }, [visible]);\n\n  const onAnimateLeave = () => {\n    if (wrap.current) {\n      wrap.current.style.display = 'none';\n    }\n    if (isModal && preventScrollThrough) {\n      // 还原 body 的滚动条\n      const openDialogDom = document.querySelectorAll(`${prefixCls}__mode`);\n      if (isModal && openDialogDom.length < 1) {\n        document.body.style.overflow = bodyOverflow.current;\n      }\n    }\n    if (!isModal) {\n      // 关闭弹窗 清空拖拽设置的相关 css\n      const { style } = dialog.current;\n      style.position = 'relative';\n      style.left = 'unset';\n      style.top = 'unset';\n    }\n    onClosed && onClosed();\n  };\n\n  const onMaskClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (showOverlay && (closeOnOverlayClick ?? local.closeOnOverlayClick)) {\n      // 判断点击事件初次点击是否为内容区域\n      if (contentClickRef.current) {\n        contentClickRef.current = false;\n      } else if (e.target === dialogPosition.current) {\n        onOverlayClick({ e });\n        onClose({ e, trigger: 'overlay' });\n      }\n    }\n  };\n\n  const handleCloseBtnClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    onCloseBtnClick({ e });\n    onClose({ e, trigger: 'close-btn' });\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n    if (e.key === 'Escape') {\n      e.stopPropagation();\n      onEscKeydown({ e });\n      if (closeOnEscKeydown ?? local.closeOnEscKeydown) {\n        onClose({ e, trigger: 'esc' });\n      }\n    } else if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n      // 回车键触发点击确认事件\n      e.stopPropagation();\n      if (confirmOnEnter) {\n        onConfirm({ e });\n      }\n    }\n  };\n\n  const renderDialog = () => {\n    const dest: any = {};\n    if (props.width !== undefined) {\n      dest.width = GetCSSValue(props.width);\n    }\n    // normal 场景下，需要设置 zindex 为auto 避免出现多个 dialog，normal 出现在最上层\n    if (props.mode === 'normal') {\n      dest.zIndex = 'auto';\n    }\n    const footer = props.footer ? <div className={`${prefixCls}__footer`}>{props.footer}</div> : null;\n\n    const { header } = props;\n\n    const body = <div className={`${prefixCls}__body`}>{props.body || props.children}</div>;\n\n    const closer = closeBtn && (\n      <span onClick={handleCloseBtnClick} className={`${prefixCls}__close`}>\n        {closeBtn}\n      </span>\n    );\n    const validWindow = typeof window === 'object';\n\n    const screenHeight = validWindow ? window.innerHeight || document.documentElement.clientHeight : undefined;\n    const screenWidth = validWindow ? window.innerWidth || document.documentElement.clientWidth : undefined;\n\n    const style = { ...dest, ...props.style };\n    let dialogOffset = { x: 0, y: 0 };\n    // 拖拽代码实现部分\n    const onDialogMove = (e: MouseEvent) => {\n      const { style, offsetWidth, offsetHeight } = dialog.current;\n\n      let diffX = e.clientX - dialogOffset.x;\n      let diffY = e.clientY - dialogOffset.y;\n      // 拖拽上左边界限制\n      if (diffX < 0) diffX = 0;\n      if (diffY < 0) diffY = 0;\n      if (screenWidth - offsetWidth - diffX < 0) diffX = screenWidth - offsetWidth;\n      if (screenHeight - offsetHeight - diffY < 0) diffY = screenHeight - offsetHeight;\n      style.position = 'absolute';\n      style.left = `${diffX}px`;\n      style.top = `${diffY}px`;\n    };\n\n    const onDialogMoveEnd = () => {\n      dialog.current.style.cursor = 'default';\n      document.removeEventListener('mousemove', onDialogMove);\n      document.removeEventListener('mouseup', onDialogMoveEnd);\n    };\n\n    const onDialogMoveStart = (e: React.MouseEvent<HTMLDivElement>) => {\n      contentClickRef.current = true;\n      // 阻止事件冒泡\n      if (canDraggable && e.currentTarget === e.target) {\n        const { offsetLeft, offsetTop, offsetHeight, offsetWidth } = dialog.current;\n        // 如果弹出框超出屏幕范围 不能进行拖拽\n        if (offsetWidth > screenWidth || offsetHeight > screenHeight) return;\n        dialog.current.style.cursor = 'move';\n        // 计算鼠标\n        const diffX = e.clientX - offsetLeft;\n        const diffY = e.clientY - offsetTop;\n        dialogOffset = {\n          x: diffX,\n          y: diffY,\n        };\n\n        document.addEventListener('mousemove', onDialogMove);\n        document.addEventListener('mouseup', onDialogMoveEnd);\n      }\n    };\n    // 顶部定位实现\n    const positionStyle: any = {};\n    if (props.top) {\n      const topValue = GetCSSValue(props.top);\n      positionStyle.paddingTop = topValue;\n    }\n    // 此处获取定位方式 top 优先级较高 存在时 默认使用 top 定位\n    const positionClass = classnames(\n      `${prefixCls}__position`,\n      { [`${prefixCls}--top`]: !!props.top },\n      `${props.placement && !props.top ? `${prefixCls}--${props.placement}` : ''}`,\n    );\n    const dialogElement = (\n      <div className={isNormal ? '' : `${prefixCls}__wrap`}>\n        <div className={isNormal ? '' : positionClass} style={positionStyle} onClick={onMaskClick} ref={dialogPosition}>\n          <div\n            ref={dialog}\n            style={style}\n            className={classnames(`${prefixCls}`, `${prefixCls}--default`)}\n            onMouseDown={onDialogMoveStart}\n          >\n            {closer}\n            {header}\n            {body}\n            {footer}\n          </div>\n        </div>\n      </div>\n    );\n\n    return (\n      <CSSTransition\n        in={props.visible}\n        appear\n        mountOnEnter\n        unmountOnExit={destroyOnClose}\n        timeout={transitionTime}\n        classNames={`${prefixCls}-zoom`}\n        onEntered={props.onOpened}\n        onExited={onAnimateLeave}\n        nodeRef={dialog}\n      >\n        {dialogElement}\n      </CSSTransition>\n    );\n  };\n\n  const renderMask = () => {\n    let maskElement;\n    if (showOverlay) {\n      maskElement = (\n        <CSSTransition\n          in={visible}\n          appear\n          timeout={transitionTime}\n          classNames={`${prefixCls}-fade`}\n          mountOnEnter\n          unmountOnExit\n          nodeRef={maskRef}\n        >\n          <div ref={maskRef} className={`${prefixCls}__mask`} />\n        </CSSTransition>\n      );\n    }\n    return maskElement;\n  };\n\n  const render = () => {\n    const style: CSSProperties = {};\n    if (visible) {\n      style.display = 'block';\n    }\n    const wrapStyle = {\n      ...style,\n      zIndex,\n    };\n\n    const dialogBody = renderDialog();\n    const wrapClass = classnames(\n      props.className,\n      `${prefixCls}__ctx`,\n      !isNormal ? `${prefixCls}__ctx--fixed` : '',\n      visible ? dialogOpenClass : '',\n      isModal && showInAttachedElement ? `${prefixCls}__ctx--absolute` : '',\n      props.mode === 'modeless' ? `${prefixCls}__ctx--modeless` : '',\n    );\n    // 如果不是 modal 模式 默认没有 mask 也就没有相关点击 mask 事件\n    const dialog = (\n      <div ref={wrap} className={wrapClass} style={wrapStyle} onKeyDown={handleKeyDown} tabIndex={0}>\n        {mode === 'modal' && renderMask()}\n        {dialogBody}\n      </div>\n    );\n\n    let dom = null;\n    if (visible || wrap.current) {\n      // normal 模式 attach 无效\n      if (attach === '' || isNormal) {\n        dom = dialog;\n      } else {\n        dom = (\n          <CSSTransition\n            in={visible}\n            appear\n            timeout={transitionTime}\n            mountOnEnter\n            unmountOnExit={destroyOnClose}\n            nodeRef={portalRef}\n          >\n            <Portal attach={attach} ref={portalRef}>\n              {dialog}\n            </Portal>\n          </CSSTransition>\n        );\n      }\n    }\n    return dom;\n  };\n\n  return render();\n});\n\nRenderDialog.defaultProps = dialogDefaultProps;\n\nexport default RenderDialog;\n"],"names":["GetCSSValue","v","Number","isNaN","transitionTime","mousePosition","getClickPosition","e","x","clientX","y","clientY","setTimeout","window","document","documentElement","addEventListener","RenderDialog","forwardRef","props","ref","useLocaleReceiver","_slicedToArray","local","prefixCls","attach","visible","mode","zIndex","showOverlay","onEscKeydown","noop","onClosed","onClose","onCloseBtnClick","onOverlayClick","onConfirm","preventScrollThrough","closeBtn","closeOnEscKeydown","confirmOnEnter","closeOnOverlayClick","destroyOnClose","showInAttachedElement","wrap","useRef","dialog","dialogPosition","maskRef","portalRef","bodyOverflow","bodyCssTextRef","contentClickRef","isModal","isNormal","canDraggable","draggable","dialogOpenClass","useDialogEsc","useImperativeHandle","current","useLayoutEffect","body","style","overflow","cssText","scrollWidth","innerWidth","offsetWidth","bodyCssText","width","position","focus","openDialogDom","querySelectorAll","length","useEffect","transformOrigin","offsetLeft","offsetTop","onAnimateLeave","display","left","top","onMaskClick","target","trigger","handleCloseBtnClick","handleKeyDown","key","stopPropagation","renderDialog","dest","footer","React","createElement","className","header","children","closer","onClick","validWindow","screenHeight","innerHeight","clientHeight","screenWidth","clientWidth","dialogOffset","onDialogMove","offsetHeight","diffX","diffY","onDialogMoveEnd","cursor","removeEventListener","onDialogMoveStart","currentTarget","positionStyle","topValue","paddingTop","positionClass","classnames","_defineProperty","placement","dialogElement","onMouseDown","CSSTransition","appear","mountOnEnter","unmountOnExit","timeout","classNames","onEntered","onOpened","onExited","nodeRef","renderMask","maskElement","render","wrapStyle","dialogBody","wrapClass","onKeyDown","tabIndex","dom","Portal","defaultProps","dialogDefaultProps"],"mappings":"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"}