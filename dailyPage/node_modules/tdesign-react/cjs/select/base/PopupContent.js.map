{"version":3,"file":"PopupContent.js","sources":["../../../src/select/base/PopupContent.tsx"],"sourcesContent":["import React, { Children, Ref, forwardRef, isValidElement, cloneElement } from 'react';\nimport classNames from 'classnames';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { getSelectValueArr } from '../util/helper';\nimport { TdSelectProps, SelectValue, TdOptionProps, SelectValueChangeTrigger } from '../type';\nimport useConfig from '../../hooks/useConfig';\nimport Option, { SelectOptionProps } from './Option';\n\ntype OptionsType = TdOptionProps[];\n\ninterface SelectPopupProps\n  extends Pick<\n    TdSelectProps,\n    | 'value'\n    | 'size'\n    | 'multiple'\n    | 'empty'\n    | 'options'\n    | 'max'\n    | 'loadingText'\n    | 'loading'\n    | 'valueType'\n    | 'keys'\n    | 'panelTopContent'\n    | 'panelBottomContent'\n  > {\n  onChange?: (\n    value: SelectValue,\n    context?: {\n      label?: string | number;\n      restData?: Record<string, any>;\n      e: React.MouseEvent<HTMLLIElement>;\n      trigger: SelectValueChangeTrigger;\n    },\n  ) => void;\n  /**\n   * 是否展示popup\n   */\n  showPopup: boolean;\n  /**\n   * 控制popup展示的函数\n   */\n  setShowPopup: (show: boolean) => void;\n  children?: React.ReactNode;\n}\n\nconst PopupContent = forwardRef((props: SelectPopupProps, ref: Ref<HTMLDivElement>) => {\n  const {\n    onChange,\n    value,\n    size,\n    max,\n    multiple,\n    showPopup,\n    setShowPopup,\n    options,\n    empty,\n    loadingText,\n    loading,\n    valueType,\n    children,\n    keys,\n    panelTopContent,\n    panelBottomContent,\n  } = props;\n\n  // 国际化文本初始化\n  const [local, t] = useLocaleReceiver('select');\n  const emptyText = t(local.empty);\n\n  const { classPrefix } = useConfig();\n  if (!children && !props.options) return null;\n\n  const onSelect: SelectOptionProps['onSelect'] = (selectedValue, { label, selected, event, restData }) => {\n    const isValObj = valueType === 'object';\n    let objVal = {};\n    if (isValObj) {\n      objVal = { ...restData };\n      if (!keys?.label) {\n        Object.assign(objVal, { label });\n      }\n      if (!keys?.value) {\n        Object.assign(objVal, { value: selectedValue });\n      }\n    }\n\n    if (!Object.keys(objVal).length) {\n      Object.assign(objVal, { [keys?.label || 'label']: label, [keys?.value || 'value']: selectedValue });\n    }\n    if (multiple) {\n      // calc multiple select values\n      const values = getSelectValueArr(value, selectedValue, selected, valueType, keys, objVal);\n      onChange(values, { label, e: event, trigger: 'check' });\n    } else {\n      // calc single select value\n      const selectVal = valueType === 'object' ? objVal : selectedValue;\n\n      onChange(selectVal, { label, e: event, trigger: 'check' });\n      setShowPopup(!showPopup);\n    }\n  };\n\n  const childrenWithProps = Children.map(children, (child) => {\n    if (isValidElement(child)) {\n      const addedProps = { size, max, multiple, selectedValue: value, onSelect };\n      return cloneElement(child, { ...addedProps });\n    }\n    return child;\n  });\n\n  // 渲染 options\n  const renderOptions = () => {\n    if (options) {\n      const uniqueOptions = [];\n      options.forEach((option: SelectOptionProps) => {\n        const index = uniqueOptions.findIndex((item) => item.label === option.label && item.value === option.value);\n        if (index === -1) {\n          uniqueOptions.push(option);\n        }\n      });\n      // 通过 options API配置的\n      return (\n        <ul className={`${classPrefix}-select__list`}>\n          {(uniqueOptions as OptionsType).map(\n            ({ value: optionValue, label, disabled, content, ...restData }, index) => (\n              <Option\n                key={index}\n                max={max}\n                label={label}\n                value={optionValue}\n                onSelect={onSelect}\n                selectedValue={value}\n                multiple={multiple}\n                size={size}\n                disabled={disabled}\n                restData={restData}\n                keys={keys}\n                content={content}\n              />\n            ),\n          )}\n        </ul>\n      );\n    }\n    return <ul className={`${classPrefix}-select__list`}>{childrenWithProps}</ul>;\n  };\n\n  const isEmpty = (Array.isArray(childrenWithProps) && !childrenWithProps.length) || (options && options.length === 0);\n\n  return (\n    <div\n      ref={ref}\n      className={classNames(`${classPrefix}-select__dropdown-inner`, {\n        [`${classPrefix}-select__dropdown-inner--size-s`]: size === 'small',\n        [`${classPrefix}-select__dropdown-inner--size-l`]: size === 'large',\n        [`${classPrefix}-select__dropdown-inner--size-m`]: size === 'medium',\n      })}\n    >\n      {panelTopContent}\n      {loading && <div className={`${classPrefix}-select__loading-tips`}>{loadingText}</div>}\n      {!loading && isEmpty && (\n        <div className={`${classPrefix}-select__empty`}>{empty ? empty : <p>{emptyText}</p>}</div>\n      )}\n      {!loading && !isEmpty && renderOptions()}\n      {panelBottomContent}\n    </div>\n  );\n});\n\nexport default PopupContent;\n"],"names":["PopupContent","forwardRef","props","ref","onChange","value","size","max","multiple","showPopup","setShowPopup","options","empty","loadingText","loading","valueType","children","keys","panelTopContent","panelBottomContent","useLocaleReceiver","_slicedToArray","local","t","emptyText","useConfig","classPrefix","onSelect","selectedValue","label","selected","event","restData","isValObj","objVal","Object","assign","length","_defineProperty","values","getSelectValueArr","e","trigger","selectVal","childrenWithProps","Children","map","child","isValidElement","addedProps","cloneElement","renderOptions","uniqueOptions","forEach","option","index","findIndex","item","push","React","createElement","className","optionValue","disabled","content","_objectWithoutProperties","Option","key","isEmpty","Array","isArray","classNames"],"mappings":"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"}