{"version":3,"file":"useOverlayInnerStyle.js","sources":["../../src/select-input/useOverlayInnerStyle.ts"],"sourcesContent":["import React, { useMemo, useState } from 'react';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdSelectInputProps } from './type';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\n\nexport type overlayStyleProps = Pick<\n  TdSelectInputProps,\n  'popupProps' | 'autoWidth' | 'readonly' | 'onPopupVisibleChange' | 'allowInput'\n>;\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n\nexport default function useOverlayInnerStyle(props: overlayStyleProps) {\n  const { popupProps, autoWidth, readonly, onPopupVisibleChange, allowInput } = props;\n  const [innerPopupVisible, setInnerPopupVisible] = useState(false);\n\n  const matchWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    if (!triggerElement || !popupElement) return;\n    // 避免因滚动条出现文本省略，预留宽度 8\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? 8 : 0;\n    const width =\n      popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n        ? popupElement.offsetWidth\n        : triggerElement.offsetWidth;\n    let otherOverlayInnerStyle: React.CSSProperties = {};\n    if (popupProps && typeof popupProps.overlayInnerStyle === 'object' && !popupProps.overlayInnerStyle.width) {\n      otherOverlayInnerStyle = popupProps.overlayInnerStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayInnerStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n    if (readonly) return;\n    // 如果点击触发元素（输入框）且为可输入状态，则继续显示下拉框\n    const newVisible = context.trigger === 'trigger-element-click' && allowInput ? true : visible;\n    setInnerPopupVisible(newVisible);\n    onPopupVisibleChange?.(newVisible, context);\n  };\n\n  const tOverlayInnerStyle = useMemo(() => {\n    let result: TdPopupProps['overlayInnerStyle'] = {};\n    const overlayInnerStyle = popupProps?.overlayInnerStyle || {};\n    if (isFunction(overlayInnerStyle) || (isObject(overlayInnerStyle) && overlayInnerStyle.width)) {\n      result = overlayInnerStyle;\n    } else if (!autoWidth) {\n      result = matchWidthFunc;\n    }\n    return result;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoWidth, popupProps?.overlayInnerStyle]);\n\n  return {\n    tOverlayInnerStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"names":["MAX_POPUP_WIDTH","useOverlayInnerStyle","props","popupProps","autoWidth","readonly","onPopupVisibleChange","allowInput","useState","_slicedToArray","innerPopupVisible","setInnerPopupVisible","matchWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayInnerStyle","_typeof","overlayInnerStyle","Math","min","onInnerPopupVisibleChange","visible","context","newVisible","trigger","tOverlayInnerStyle","useMemo","result","isFunction","isObject"],"mappings":"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"}