{"version":3,"file":"useWatch.js","sources":["../../../src/form/hooks/useWatch.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useRef } from 'react';\nimport get from 'lodash/get';\nimport type { NamePath } from '../type';\nimport type { InternalFormInstance } from './interface';\nimport { HOOK_MARK } from './useForm';\n\nexport default function useWatch(name: NamePath, form: InternalFormInstance) {\n  const [value, setValue] = useState<any>();\n  const valueStr = useMemo(() => JSON.stringify(value), [value]);\n  const valueStrRef = useRef(valueStr);\n\n  // eslint-disable-next-line\n  const isValidForm = form && form._init;\n\n  useEffect(() => {\n    if (!isValidForm) return;\n\n    const { getFieldsValue, getInternalHooks } = form;\n    const { registerWatch } = getInternalHooks(HOOK_MARK);\n\n    const cancelRegister = registerWatch(() => {\n      const allFieldsValue = getFieldsValue(true);\n      const newValue = get(allFieldsValue, name);\n      const nextValueStr = JSON.stringify(newValue);\n\n      // Compare stringify in case it's nest object\n      if (valueStrRef.current !== nextValueStr) {\n        valueStrRef.current = nextValueStr;\n        setValue(newValue);\n      }\n    });\n\n    const allFieldsValue = getFieldsValue(true);\n    const initialValue = get(allFieldsValue, name);\n    setValue(initialValue);\n\n    return cancelRegister;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return value;\n}\n"],"names":["useWatch","name","form","useState","_slicedToArray","value","setValue","valueStr","useMemo","JSON","stringify","valueStrRef","useRef","isValidForm","_init","useEffect","getFieldsValue","getInternalHooks","HOOK_MARK","registerWatch","cancelRegister","allFieldsValue","newValue","get","nextValueStr","current","initialValue"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMwB,SAAAA,QAAA,CAASC,IAAT,EAAyBC,IAAzB,EAAqD;AAC3E,EAAA,IAAA,SAAA,GAA0BC,cAAc,EAAxC;AAAA,MAAA,UAAA,GAAAC,4BAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,KAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAcC,QAAd,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACM,IAAAC,QAAA,GAAWC,cAAQ,YAAA;AAAA,IAAA,OAAMC,IAAA,CAAKC,SAAL,CAAeL,KAAf,CAAN,CAAA;AAAA,KAA6B,CAACA,KAAD,EAAhD,CAAA;AACA,EAAA,IAAAM,WAAA,GAAcC,aAAOL,SAArB,CAAA;AAGA,EAAA,IAAAM,WAAA,GAAcX,QAAQA,IAAK,CAAAY,KAA3B,CAAA;AAENC,EAAAA,eAAA,CAAU,YAAM;IACd,IAAI,CAACF,WAAL,EAAkB,OAAA;AAEZ,IAAA,IAAEG,cAAF,GAAuCd,IAAvC,CAAEc,cAAF;AAAA,QAAkBC,gBAAlB,GAAuCf,IAAvC,CAAkBe,gBAAlB,CAAA;;IACN,IAA0BA,iBAAAA,GAAAA,gBAAA,CAAiBC,4BAAjB,CAA1B;QAAQC,aAAR,qBAAQA,aAAR,CAAA;;AAEM,IAAA,IAAAC,cAAA,GAAiBD,cAAc,YAAM;AACnCE,MAAAA,IAAAA,eAAAA,GAAiBL,eAAe,KAAhCK,CAAAA;AACA,MAAA,IAAAC,QAAA,GAAWC,SAAIF,CAAAA,eAAAA,EAAgBpB,IAAhBoB,CAAf,CAAA;AACA,MAAA,IAAAG,YAAA,GAAef,IAAK,CAAAC,SAAL,CAAeY,QAAf,CAAf,CAAA;;AAGF,MAAA,IAAAX,WAAA,CAAYc,OAAZ,KAAwBD,YAAxB,EAAsC;QACxCb,WAAA,CAAYc,OAAZ,GAAsBD,YAAtB,CAAA;QACAlB,QAAA,CAASgB,QAAT,CAAA,CAAA;AACF,OAAA;AACD,MAVK,CAAA;AAYA,IAAA,IAAAD,cAAA,GAAiBL,eAAe,KAAhC,CAAA;AACA,IAAA,IAAAU,YAAA,GAAeH,SAAI,CAAAF,cAAA,EAAgBpB,IAAhB,CAAnB,CAAA;IACNK,QAAA,CAASoB,YAAT,CAAA,CAAA;AAEO,IAAA,OAAAN,cAAA,CAAA;GAtBT,EAwBG,EAxBH,CAAA,CAAA;AA0BO,EAAA,OAAAf,KAAA,CAAA;AACT;;;;"}