/**
 * tdesign v0.42.2
 * (c) 2022 tdesign
 * @license MIT
 */

import { _ as _slicedToArray } from '../../_chunks/dep-2baf8638.js';
import { _ as _createClass, a as _classCallCheck } from '../../_chunks/dep-a58d2703.js';
import { _ as _defineProperty } from '../../_chunks/dep-ebef14de.js';
import { useRef, useState } from 'react';
import log from '../../_common/js/log/log.js';
import '../../_chunks/dep-24599104.js';

var HOOK_MARK = Symbol("TD_FORM_INTERNAL_HOOKS");

var FormStore = /*#__PURE__*/_createClass(function FormStore(forceRootUpdate) {
  var _this = this;

  _classCallCheck(this, FormStore);

  _defineProperty(this, "prevStore", {});

  _defineProperty(this, "store", {});

  _defineProperty(this, "getForm", function () {
    return {
      submit: null,
      reset: null,
      validate: null,
      validateOnly: null,
      clearValidate: null,
      setFields: null,
      setFieldsValue: null,
      setValidateMessage: null,
      getFieldValue: null,
      getFieldsValue: null,
      _init: true,
      getInternalHooks: _this.getInternalHooks
    };
  });

  _defineProperty(this, "getInternalHooks", function (key) {
    if (key === HOOK_MARK) {
      return {
        notifyWatch: _this.notifyWatch,
        registerWatch: _this.registerWatch,
        getPrevStore: function getPrevStore() {
          return _this.prevStore;
        },
        setPrevStore: function setPrevStore(store) {
          _this.prevStore = store;
        }
      };
    }

    log.warn("Form", "`getInternalHooks` is internal usage. Should not call directly.");
    return null;
  });

  _defineProperty(this, "watchList", []);

  _defineProperty(this, "registerWatch", function (callback) {
    _this.watchList.push(callback);

    return function () {
      _this.watchList = _this.watchList.filter(function (fn) {
        return fn !== callback;
      });
    };
  });

  _defineProperty(this, "notifyWatch", function () {
    var namePath = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

    if (_this.watchList.length) {
      var _this$getFieldsValue;

      var values = (_this$getFieldsValue = _this.getFieldsValue) === null || _this$getFieldsValue === void 0 ? void 0 : _this$getFieldsValue.call(_this, namePath);

      _this.watchList.forEach(function (callback) {
        callback(values, namePath);
      });
    }
  });

  _defineProperty(this, "getFieldsValue", null);

  this.forceRootUpdate = forceRootUpdate;
});

function useForm(form) {
  var formRef = useRef({});

  var _useState = useState({}),
      _useState2 = _slicedToArray(_useState, 2),
      forceUpdate = _useState2[1];

  if (!formRef.current._init) {
    if (form) {
      formRef.current = form;
    } else {
      var forceReRender = function forceReRender() {
        forceUpdate({});
      };

      var formStore = new FormStore(forceReRender);
      formRef.current = formStore.getForm();
    }
  }

  return [formRef.current];
}

export { HOOK_MARK, useForm as default };
//# sourceMappingURL=useForm.js.map
