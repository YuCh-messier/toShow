/**
 * tdesign v0.42.2
 * (c) 2022 tdesign
 * @license MIT
 */

import { _ as _slicedToArray } from '../../_chunks/dep-2baf8638.js';
import { useState, useMemo, useRef, useEffect } from 'react';
import { g as get_1 } from '../../_chunks/dep-bca278f2.js';
import { HOOK_MARK } from './useForm.js';
import '../../_chunks/dep-24599104.js';
import '../../_chunks/dep-6a110e92.js';
import '../../_chunks/dep-c393cab2.js';
import '../../_chunks/dep-3627969a.js';
import '../../_chunks/dep-893e0247.js';
import '../../_chunks/dep-cf61d761.js';
import '../../_chunks/dep-090fa3b2.js';
import '../../_chunks/dep-339b0951.js';
import '../../_chunks/dep-ba4fa05d.js';
import '../../_chunks/dep-00ad7a91.js';
import '../../_chunks/dep-056b9d81.js';
import '../../_chunks/dep-86599c44.js';
import '../../_chunks/dep-2998e451.js';
import '../../_chunks/dep-a58d2703.js';
import '../../_chunks/dep-ebef14de.js';
import '../../_common/js/log/log.js';

function useWatch(name, form) {
  var _useState = useState(),
      _useState2 = _slicedToArray(_useState, 2),
      value = _useState2[0],
      setValue = _useState2[1];

  var valueStr = useMemo(function () {
    return JSON.stringify(value);
  }, [value]);
  var valueStrRef = useRef(valueStr);
  var isValidForm = form && form._init;
  useEffect(function () {
    if (!isValidForm) return;
    var getFieldsValue = form.getFieldsValue,
        getInternalHooks = form.getInternalHooks;

    var _getInternalHooks = getInternalHooks(HOOK_MARK),
        registerWatch = _getInternalHooks.registerWatch;

    var cancelRegister = registerWatch(function () {
      var allFieldsValue2 = getFieldsValue(true);
      var newValue = get_1(allFieldsValue2, name);
      var nextValueStr = JSON.stringify(newValue);

      if (valueStrRef.current !== nextValueStr) {
        valueStrRef.current = nextValueStr;
        setValue(newValue);
      }
    });
    var allFieldsValue = getFieldsValue(true);
    var initialValue = get_1(allFieldsValue, name);
    setValue(initialValue);
    return cancelRegister;
  }, []);
  return value;
}

export { useWatch as default };
//# sourceMappingURL=useWatch.js.map
