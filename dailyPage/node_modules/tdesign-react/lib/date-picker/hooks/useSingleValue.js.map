{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport dayjs from 'dayjs';\nimport { formatDate, formatTime, isValidDate, getDefaultFormat } from '../../_common/js/date-picker/format';\nimport useControlled from '../../hooks/useControlled';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\nimport log from '../../_common/js/log';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { format, timeFormat } = getDefaultFormat({\n    mode: props.mode,\n    format: props.format,\n    enableTimePicker: props.enableTimePicker,\n  });\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(format))\n      log.error('DatePicker', `format: ${format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const [time, setTime] = useState(formatTime(value, timeFormat));\n  const [month, setMonth] = useState<number>(dayjs(value).month() || new Date().getMonth());\n  const [year, setYear] = useState<number>(dayjs(value).year() || new Date().getFullYear());\n  const [cacheValue, setCacheValue] = useState(formatDate(value, { format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  useEffect(() => {\n    if (!value) {\n      setCacheValue('');\n      return;\n    }\n    if (!isValidDate(value, format)) return;\n\n    setCacheValue(formatDate(value, { format }));\n    setTime(formatTime(value, timeFormat));\n    // eslint-disable-next-line\n  }, [value]);\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n    setYear,\n    setMonth,\n    setTime,\n    setCacheValue,\n  };\n}\n"],"names":["useSingleValue","props","useControlled","onChange","value","getDefaultFormat","mode","format","enableTimePicker","timeFormat","extractTimeFormat","log","error","useState","formatTime","time","setTime","dayjs","month","Date","getMonth","setMonth","year","getFullYear","setYear","formatDate","cacheValue","setCacheValue","useEffect","isValidDate"],"mappings":"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"}