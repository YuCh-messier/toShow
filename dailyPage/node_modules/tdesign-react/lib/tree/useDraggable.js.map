{"version":3,"file":"useDraggable.js","sources":["../../src/tree/useDraggable.tsx"],"sourcesContent":["import throttle from 'lodash/throttle';\nimport { RefObject, DragEvent, useState, useRef } from 'react';\nimport { TreeNode } from '../_common/js/tree/tree-node';\nimport { useTreeDraggableContext } from './TreeDraggableContext';\nimport { DropPosition } from './interface';\nimport { usePersistFn } from '../_util/usePersistFn';\n\nexport default function useDraggable(props: { nodeRef: RefObject<HTMLElement | undefined>; node: TreeNode }) {\n  const { nodeRef, node } = props;\n  const { onDragStart, onDragEnd, onDragLeave, onDragOver, onDrop } = useTreeDraggableContext();\n\n  const [state, setState] = useState<{\n    isDragOver: boolean;\n    isDragging: boolean;\n    dropPosition: DropPosition;\n  }>({\n    isDragOver: false,\n    isDragging: false,\n    dropPosition: 0,\n  });\n\n  const setPartialState = usePersistFn((newState: Partial<typeof state>) => {\n    setState((prev) => ({\n      ...prev,\n      ...newState,\n    }));\n  });\n\n  const updateDropPosition = useRef(\n    throttle((e: DragEvent) => {\n      if (!nodeRef.current) return;\n\n      const rect = nodeRef.current.getBoundingClientRect();\n      const offsetY = window.pageYOffset + rect.top;\n      const { pageY } = e;\n      const gapHeight = rect.height / 4;\n      const diff = pageY - offsetY;\n\n      if (diff < gapHeight) {\n        setPartialState({ dropPosition: -1 });\n      } else if (diff < rect.height - gapHeight) {\n        setPartialState({ dropPosition: 0 });\n      } else {\n        setPartialState({ dropPosition: 1 });\n      }\n    }),\n  ).current;\n\n  const setDragStatus = (status: 'dragStart' | 'dragOver' | 'dragLeave' | 'dragEnd' | 'drop', e: DragEvent) => {\n    switch (status) {\n      case 'dragStart':\n        setPartialState({\n          isDragging: true,\n          dropPosition: 0,\n        });\n        onDragStart?.({ node, e });\n        break;\n      case 'dragEnd':\n        setPartialState({\n          isDragging: false,\n          isDragOver: false,\n          dropPosition: 0,\n        });\n        updateDropPosition.cancel();\n        onDragEnd?.({ node, e });\n        break;\n      case 'dragOver':\n        setPartialState({\n          isDragOver: true,\n        });\n        updateDropPosition(e);\n        onDragOver?.({ node, e });\n        break;\n      case 'dragLeave':\n        setPartialState({\n          isDragOver: false,\n          dropPosition: 0,\n        });\n        updateDropPosition.cancel();\n        onDragLeave?.({ node, e });\n        break;\n      case 'drop':\n        onDrop?.({ node, dropPosition: state.dropPosition, e });\n        setPartialState({\n          isDragOver: false,\n        });\n        updateDropPosition.cancel();\n        break;\n      default:\n        break;\n    }\n  };\n\n  return {\n    ...state,\n    setDragStatus,\n  };\n}\n"],"names":["useDraggable","props","nodeRef","node","useTreeDraggableContext","onDragStart","onDragEnd","onDragLeave","onDragOver","onDrop","useState","isDragOver","isDragging","dropPosition","state","setState","setPartialState","usePersistFn","newState","prev","updateDropPosition","useRef","throttle","e","current","rect","getBoundingClientRect","offsetY","window","pageYOffset","top","pageY","gapHeight","height","diff","setDragStatus","status","cancel"],"mappings":"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"}