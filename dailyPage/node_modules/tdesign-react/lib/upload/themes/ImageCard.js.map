{"version":3,"file":"ImageCard.js","sources":["../../../src/upload/themes/ImageCard.tsx"],"sourcesContent":["import React, { MouseEvent } from 'react';\nimport {\n  BrowseIcon as TdBrowseIcon,\n  DeleteIcon as TdDeleteIcon,\n  AddIcon as TdAddIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n} from 'tdesign-icons-react';\nimport Loading from '../../loading';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\nimport ImageViewer from '../../image-viewer';\nimport { CommonDisplayFileProps } from '../interface';\nimport { TdUploadProps, UploadFile } from '../type';\n\nexport interface ImageCardUploadProps extends CommonDisplayFileProps {\n  multiple: TdUploadProps['multiple'];\n  max: TdUploadProps['max'];\n  disabled?: TdUploadProps['disabled'];\n  showUploadProgress: TdUploadProps['showUploadProgress'];\n  triggerUpload?: () => void;\n  uploadFiles?: (toFiles?: UploadFile[]) => void;\n  cancelUpload?: (context: { e: MouseEvent<HTMLElement>; file: UploadFile }) => void;\n  onPreview?: TdUploadProps['onPreview'];\n}\n\nconst ImageCard = (props: ImageCardUploadProps) => {\n  const { displayFiles, locale, classPrefix, multiple, max = 0, onRemove, disabled } = props;\n  const { BrowseIcon, DeleteIcon, AddIcon, ErrorCircleFilledIcon } = useGlobalIcon({\n    AddIcon: TdAddIcon,\n    BrowseIcon: TdBrowseIcon,\n    DeleteIcon: TdDeleteIcon,\n    ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n  });\n\n  const showTrigger = React.useMemo(() => {\n    if (multiple) {\n      return !max || displayFiles.length < max;\n    }\n    return !displayFiles?.[0];\n  }, [displayFiles, max, multiple]);\n\n  const renderMainContent = (file: UploadFile, index: number) => (\n    <div className={`${classPrefix}-upload__card-content ${classPrefix}-upload__card-box`}>\n      <img className={`${classPrefix}-upload__card-image`} src={file.url} />\n      <div className={`${classPrefix}-upload__card-mask`}>\n        <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n          <ImageViewer\n            trigger={({ onOpen }) => (\n              <BrowseIcon\n                onClick={(e) => {\n                  props.onPreview?.({ file, index, e });\n                  onOpen();\n                }}\n              />\n            )}\n            images={displayFiles.map((t) => t.url)}\n            defaultIndex={index}\n          />\n        </span>\n        {!disabled && (\n          <>\n            <span className={`${classPrefix}-upload__card-mask-item-divider`} />\n            <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n              <DeleteIcon onClick={(e) => onRemove?.({ e, file, index })} />\n            </span>\n          </>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderProgressFile = (file: UploadFile, loadCard: string) => (\n      <div className={loadCard}>\n        <Loading loading={true} size=\"medium\" />\n        <p>\n          {locale?.progress?.uploadingText}\n          {props.showUploadProgress ? ` ${file.percent}%` : ''}\n        </p>\n      </div>\n    );\n\n  const renderFailFile = (file: UploadFile, index: number, loadCard: string) => (\n      <div className={loadCard}>\n        <ErrorCircleFilledIcon />\n        <p>{file.response?.error || locale?.progress?.failText}</p>\n        <div className={`${classPrefix}-upload__card-mask`}>\n          <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n            <DeleteIcon onClick={({ e }: { e: MouseEvent }) => props?.onRemove?.({ e, file, index })} />\n          </span>\n        </div>\n      </div>\n    );\n\n  const cardItemClasses = `${classPrefix}-upload__card-item ${classPrefix}-is-background`;\n  return (\n    <div>\n      <ul className={`${classPrefix}-upload__card`}>\n        {displayFiles?.map((file: UploadFile, index: number) => {\n          const loadCard = `${classPrefix}-upload__card-container ${classPrefix}-upload__card-box`;\n          return (\n            <li className={cardItemClasses} key={index}>\n              {file.status === 'progress' && renderProgressFile(file, loadCard)}\n              {file.status === 'fail' && renderFailFile(file, index, loadCard)}\n              {!['progress', 'fail'].includes(file.status) && file.url && renderMainContent(file, index)}\n              <div className={`${classPrefix}-upload__card-name`}>{file.name}</div>\n            </li>\n          );\n        })}\n        {showTrigger && (\n          <li className={cardItemClasses} onClick={props.triggerUpload}>\n            <div className={`${classPrefix}-upload__card-container ${classPrefix}-upload__card-box`}>\n              <AddIcon />\n              <p className={`${classPrefix}-size-s`}>{locale?.triggerUploadText?.image}</p>\n            </div>\n          </li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nImageCard.displayName = 'ImageCard';\n\nexport default ImageCard;\n"],"names":["ImageCard","props","displayFiles","locale","classPrefix","multiple","max","onRemove","disabled","useGlobalIcon","AddIcon","TdAddIcon","BrowseIcon","TdBrowseIcon","DeleteIcon","TdDeleteIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","showTrigger","React","useMemo","length","renderMainContent","file","index","createElement","className","src","url","onClick","e","stopPropagation","ImageViewer","trigger","onOpen","onPreview","images","map","t","defaultIndex","renderProgressFile","loadCard","Loading","loading","size","progress","uploadingText","showUploadProgress","percent","renderFailFile","response","error","failText","cardItemClasses","key","status","includes","name","triggerUpload","triggerUploadText","image","displayName"],"mappings":"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"}